{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Hartford Open Data: Live Police Incidents\"\noutput: \n  flexdashboard::flex_dashboard:\n    theme: yeti\n  orientation: columns\n  \nvertical_layout: fill\nsocial: [ \"twitter\", \"menu\" ]\nsource_code: embed\nruntime: shiny\n---\n  \n```{r setup, include=FALSE}\nlibrary(flexdashboard)\nlibrary(DT)  # dev version devtools::install_github(\"rstudio/DT\")\nlibrary(leaflet)\nlibrary(readr)\nlibrary(lubridate)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(shiny)\n```\n\nSidebar {.sidebar}\n=====================================\n  \nThis dataset reflects reported incidents of crime (with the exception of sexual assaults, which are excluded by statute) that occurred in the City of Hartford from 2005 to the present, minus the most recent ten days. Data is extracted from the City of Hartford Police Department's CrimeView database on a daily basis.\n\n\n```{r, shiny_in}\n# shiny inputs defined here\nhr()\nselectInput(\"year\", \"Select Year: \", choices =c(2005, 2006, 2007, \n2008, 2009, 2010,\n2011, 2012, 2013, \n2014, 2015) ,\nselected = 2015)\n\n```\n\n\n\nExplore\n=====================================\n\n```{r, message=FALSE, warning=FALSE, include=FALSE}\ndata_in <- read_csv(\"Police_Incidents_01012005_to_Current.csv\") \n##############################\n# clean up lat and longitude #\n##############################\n# removes the parenthesis\ns = gsub(\".*\\\\((.*)\\\\).*\", \"\\\\1\", data_in$geom)  \n# extract and split each f the tuple latitude and longitude\nlat_splat = sapply(s, function(x) strsplit(x, \",\")[[1]][1])\nlon_splat = sapply(s, function(x) strsplit(x, \",\")[[1]][2])\n# convert to data.frame\nlat <- as.data.frame(lat_splat)\nlon <- as.data.frame(lon_splat)\n# convert to factor to numeric\noptions(digits=15)\nlat2 <- sapply(lat, function(x) as.numeric(levels(x))[x])\nlat2 <- as.data.frame(lat2)\nlon2 <- sapply(lon, function(x) as.numeric(levels(x))[x])\nlon2 <- as.data.frame(lon2)\n# add to main data frame\ndata_in$lat <- lat2\ndata_in$lon <- lon2 \n#################\n# clean up date #\n#################\nclass(data_in$Date)\ndata_in$Date <- mdy(data_in$Date)\ndata_in$year <- year(data_in$Date)\n#####################\n# clean up category #\n#####################\n## grep out leader symbol\ndata_in$UCR_1_Category <- gsub(\"[0-9]\",\"\", data_in$UCR_1_Category)\ndata_in$UCR_1_Category <- gsub(\"[[:punct:]]\",\"\", data_in$UCR_1_Category)\n\n#######################################\n# subset data by date for explore tab #\n#######################################\n## so many points!! - use sample for now\ndata_in <- as.data.frame(data_in)\ndata_sample <- reactive({\ndata_sample <- data_in[which(data_in$year == input$year), ] \ndata_sample\n})\n\n```\n\n\n### Map\n\n```{r, map}\n\nrenderLeaflet({\nm <- leaflet(data=data_sample()) %>%\nsetView(lng = -72.685097, lat = 41.763710, zoom = 11) %>%\naddProviderTiles(\"Stamen.Toner\") %>% \naddMarkers(lng=~lon$lon_splat, lat=~lat$lat_splat, \npopup = ~as.character(UCR_2_Description), \nclusterOptions = markerClusterOptions())\nm  \n})\n\n```\n\n\n### Data Table\n\n```{r, dt}\n\nDT::renderDataTable({\n\nDT::datatable(data_sample(), options = list(bPaginate = TRUE,\npageLength = 15\n))\n})\n```\n\nVisualization\n=====================================\n\n```{r, viz_dat, message=FALSE, warning=FALSE, include=FALSE}\ncategory <- dplyr::count(data_in, UCR_1_Category)\n\nneighborhood <- dplyr::count(data_in, UCR_1_Category, Neighborhood)\n\n# g1 <- ggplot(category, aes(x=reorder(UCR_1_Category, n), y = n)) +\n#       geom_bar(stat=\"identity\", fill=\"dodgerblue\") +\n#       theme(axis.text.x  =element_blank()) +\n#       coord_flip() +\n#       labs(title=\"Overall Count of Incidents of Crime Type\", x = \"\", y = \"Count\")\n\n#ggplotly(g1)\n\n```\n\n\n\n### Overall Count of Incidents of Crime by Neighborhood\n\n```{r, viz_display2}\ng2 <- ggplot(neighborhood, aes(x=reorder(Neighborhood, n), y = n, fill=factor(UCR_1_Category))) +\n      geom_bar(stat=\"identity\") +\n      theme(axis.text.x  =element_blank()) +\n      theme(legend.title=element_blank()) +\n      coord_flip() +\n      labs(title=\"Overall Count of Incidents by Crime Type & Neighborhood\", \n      x = \"\", y = \"Count\")\ng2\nggplotly(g2)\n\n```\n\n\nAnalysis {.storyboard}\n=========================================\n\n###  **Has Hartford Become Safer?**\n\n```{r}\nsafe <- dplyr::count(data_in, year)\n\np1 <- plot_ly(safe, x = year, y = n, type = \"scatter\", mode = \"markers+lines\")\n\np1 <- layout(p1, title=\"Crime Reported by Year\")\n\np1\n\n```\n\n### **Has Hartford Seen a Decrease in Violent Crimes?** \n\n**Can lower amounts of reported crime incidents be related to fewer violent crimes?**\n\n```{r}\nviolent <- dplyr::count(data_in, UCR_1_Category, year)\n\nreally_violent <- c(\"  AGGRAVATED ASSAULT\", \"  ROBBERY\", \"  HOMICIDE\", \"  LARCENY\")\n\nviolent2 <- violent[violent$UCR_1_Category %in% really_violent,]\n\nvi <-  ggplot(data=violent2, aes(x=year, y=n, group=UCR_1_Category, color=UCR_1_Category)) +\n    geom_line() +\n    geom_point() +\n    theme(legend.position=\"none\")\n\nggplotly(vi)\n\n\n```\n\n### **Guns in Hartford**\n\n**As a National issue about gun control and safety, [Conneticut has enacted the toughest restrictions on purchasing weapons and ammunition](https://en.wikipedia.org/wiki/Gun_laws_in_Connecticut) since 2012.**\n\n```{r}\n\ngun_related <- c(\"  SHOOTING\", \"  SHOTS FIRED\", \"  SHOTS FIRED CONFIRMED\", \"  SHOTS FIRED UNCONFIRMED\")\n\n```\n\n\n### **The Drug Epidemic**\n\n```{r}\ndrugs <- c(\"  DRUG OFFENSES\")\n\ndrugs_df <- dplyr::count(data_in, UCR_1_Category, year, Neighborhood) \n\ndrugs_df <- drugs_df[drugs_df$UCR_1_Category %in% drugs, ]\n\nd <- ggplot(drugs_df, aes(x=Neighborhood, y=n, group=year)) +\n     geom_bar(stat=\"identity\") +\n     facet_wrap(~ year) +\n     theme_minimal() #+\n    # geom_text()\n\nggplotly(d)\n\n```\n\n### Most Crime-Ridden Neighboorhoods\n\n\n\nAbout\n=====================================\n\n\nThis dataset reflects reported incidents of crime (with the exception of sexual assaults, which are excluded by statute) that occurred in the City of Hartford from 2005 to the present, minus the most recent ten days. Data is extracted from the City of Hartford Police Department's CrimeView database on a daily basis. Should you have questions about this dataset, you may contact the Crime Analysis Division of the Hartford Police Department at 860.757.4020 or policechief@Hartford.gov. \n\nFull Disclaimer available [Source](https://data.hartford.gov/Public-Safety/Police-Incidents-01012005-to-Current/889t-nwfu)\n\n\n\n",
    "created" : 1469822077149.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2551786206",
    "id" : "6B0A4B4F",
    "lastKnownWriteTime" : 1469830481,
    "last_content_update" : 1469830481049,
    "path" : "~/Desktop/R-directory/hartford-police/hartford-police.Rmd",
    "project_path" : "hartford-police.Rmd",
    "properties" : {
        "chunk_rendered_width" : "650"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}